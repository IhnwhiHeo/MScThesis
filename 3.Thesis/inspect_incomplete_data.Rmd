---
title: "Investigate relations in incomplete datasets to inform imputation model"
output:
  html_document:
    df_print: paged
---

The goal is to provide plots and tests to inspect: 1) the relation between observed values of one variable and the missingness indicator of another; and 2) the relation between the observed values of two variables before imputation.

```{r echo=TRUE, message=FALSE, warning=FALSE}
# set-up environment
library(mice) # Data imputation
library(dplyr) # Data manipulation
library(magrittr)
library(broom)
library(ggplot2)
set.seed(123)
```

We will use the boys data as an example, specifically the variables age and gen. We will later apply it to all variables of this dataset, and then make it compatible for different datasets as well.

```{r}
# pre-processing
Rgen <- is.na(boys$gen)
levels(Rgen) <- c("Missing", "Observed")
data <- boys %>% as_tibble %>% cbind(Rgen)

# plot relation between observed values in age and missingness in gen
data %>%
  ggplot(aes(x = age, fill = is.na(gen))) +
  geom_histogram(aes(y = 100 * ..density..),
                 alpha = 0.5,
                 position = 'identity') +
  xlab("Age (years)") +
  ylab("Percentage observed") +
  scale_fill_manual(
    name = "Gen",
    breaks = c("FALSE", "TRUE"),
    labels = c("Observed", "Missing"),
    values = c("#006CC2", "#B61A51")
  )

# evaluate statistically
out_Rgen <- data %>% lm(age ~ is.na(gen), data = .)
out_int <- data %>% lm(age ~ 1, data = .)
anova(out_int, out_Rgen)
```

Now look at relations between the observed values of these variables. **Question:** Should I also visualize this relationship?

```{r}
out_gen <- data %>% lm(age ~ gen, data = .)
out_int_gen <- data %>% filter(!is.na(gen)) %>% lm(age ~ 1, data = .)
anova(out_int_gen, out_gen)
```

So both tests indicate that we should include age in the imputation model for gen.